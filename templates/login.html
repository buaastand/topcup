<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>

    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../static/css/login.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <meta name="csrf-token" content="{{ csrf_token }}">

</head>
<body>
<div id="Login_page" class="background">
    <el-container>
        <el-header>
                <h2>科技竞赛平台</h2>
        </el-header>
        <el-main>
             <el-form action="" method="post" autocomplete="off"
             :model="loginForm"
             :rules="rules"
             status-icon
             ref="loginForm"
             label-width="100px"
             label="right">
        <el-form-item prop="username" label="学号/邮箱">
            <el-input name="username" v-model="loginForm.username" type="text" placeholder="Email/Username" style="width:80%" ></el-input>
        </el-form-item>
        <el-form-item prop="password" label="密码">
            <el-input name="password" v-model="loginForm.password" placeholder="Password" show-password  style="width:80%"></el-input>
        </el-form-item>
        <el-form-item prop="type" style="margin-top: 0" label="用户类型">
            <el-radio-group v-model="loginForm.type">
                <el-radio label="1">学生</el-radio>
                <el-radio label="3">专家</el-radio>
                <el-radio label="2">校团委</el-radio>
            </el-radio-group>
        </el-form-item>
        <el-form-item>
                <el-button type="primary" @click="onSubmit('loginForm')" style="width:80%">登录</el-button>
        </el-form-item>
    </el-form>
        </el-main>
        <el-footer>
                <div style="margin:0 auto; width: 70%;">
    <a href="/register/" style="float: left">注册</a>
    <a href="" style="float: right">忘记密码？</a>
    </div>
        </el-footer>
    </el-container>


</div>

</body>
<script>
    var app = new Vue({
    el: '#Login_page',
    data: {
        loginForm:{
        username: '',
        password: '',
        type: [],},
        rules:{
            username:[
            {required:true, message:'请输入用户名',trigger:'blur'}],
            password:[
            {required:true, message:'请输入密码',trigger:'blur'}],
            type:[
                {required:true, message:'请选择用户类型',trigger:'blur'}]
        },
    },
    methods:{
       onSubmit: function(formName) {
       this.$refs[formName].validate((valid) => {
          if (valid) {
                axios
                .post(
                    '/login/',
                    this.loginForm,
                    {headers: {'X-CSRFtoken': document.getElementsByTagName('meta')['csrf-token'].getAttribute('content')}},
                )
                .then(res =>{
                    console.log(res);
                    if(res.status == 200){
                        if(res.data['msg'] == true){
                            this.$alert('登陆成功');
                            window.location.href='/register/';
                        }else {
                            this.$alert('登录失败');
                        }
                    }
                    else {
                        this.$alert('登录失败');
                    }
                })
                .catch(err => {console.log(err)})
          } else {
            console.log('error submit!!');
            return false;
          }
        });
        }
    }
})

</script>
</html>